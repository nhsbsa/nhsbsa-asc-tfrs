{% extends "./main.html" %}

{% block header %}
  {{ govukHeader({
    rebrand: true, 
    serviceName: serviceName,
    navigation: [
      {
        href: "#",
        text: "Sign out"
      }
      ]
    }) 
  }}
  <div class="govuk-width-container">
    <div class="govuk-phase-banner">
      <p class="govuk-phase-banner__content">
        <strong class="govuk-tag govuk-phase-banner__content__tag">
          Prototype
        </strong>
        <span class="govuk-phase-banner__text">
          This is a new service â€“ your <a class="govuk-link" href="#">feedback</a> will help us to improve it.
        </span>
      </p>
    </div>
  </div>
  <div class="app-organisation-actions govuk-width-container" aria-label="Organisation switcher">
    <div class="app-organisation-actions__title">
      {{data.org.name}} <span class="app-organisation-caption">({{data.org.workplaceID}})</span>
      </div>
      <!-- <div class="app-organisation-actions__actions">
          <a class="govuk-link app-organisation-actions__link" href="/organisations">Change organisation</a>
      </div> -->
  </div>
  <div class="govuk-service-navigation" data-module="govuk-service-navigation">
    <div class="govuk-width-container">
      <div class="govuk-service-navigation__container">
        <nav aria-label="Menu" class="govuk-service-navigation__wrapper">
          <button type="button" class="govuk-service-navigation__toggle govuk-js-service-navigation-toggle" aria-controls="navigation" hidden>
            Menu
          </button>
          <ul class="govuk-service-navigation__list" id="navigation">
            <li class="govuk-service-navigation__item {% if data.tabLocation == 'claims' %}govuk-service-navigation__item--active{% endif %}">
              <a class="govuk-service-navigation__link" href="/claims/v22/manage-claims-home?tabLocation=claims&submitError=" {% if data.tabLocation == 'claims' %}aria-current="true"{% endif %}>
                <strong class="govuk-service-navigation__active-fallback">Manage claims</strong>
              </a>
            </li>
            {% if data.userType == "signatory" %}
            <li class="govuk-service-navigation__item {% if data.tabLocation == 'users' %}govuk-service-navigation__item--active{% endif %}">
              <a class="govuk-service-navigation__link" href="/claims/v22/org-admin/manage-team?tabLocation=users" {% if data.tabLocation == 'users' %}aria-current="true"{% endif %}>
                {% if data.tabLocation == 'users' %}<strong class="govuk-service-navigation__active-fallback">{% endif %}Manage submitters{% if data.tabLocation == 'users' %}</strong>{% endif %}
              </a>
            </li>
            <li class="govuk-service-navigation__item {% if data.tabLocation == 'bankDetails' %}govuk-service-navigation__item--active{% endif %}">
              <a class="govuk-service-navigation__link" href="/claims/v22/org-admin/bank-details?tabLocation=bankDetails" {% if data.tabLocation == 'bankDetails' %}aria-current="true"{% endif %}>
                {% if data.tabLocation == 'bankDetails' %}<strong class="govuk-service-navigation__active-fallback">{% endif %}Bank details{% if data.tabLocation == 'bankDetails' %}</strong>{% endif %}
              </a>
            </li>
            {% endif %}
            <li class="govuk-service-navigation__item {% if data.tabLocation == 'orgDetails' %}govuk-service-navigation__item--active{% endif %}">
              <a class="govuk-service-navigation__link" href="/claims/v22/org-admin/org-details?tabLocation=orgDetails" {% if data.tabLocation == 'orgDetails' %}aria-current="true"{% endif %}>
                {% if data.tabLocation == 'orgDetails' %}<strong class="govuk-service-navigation__active-fallback">{% endif %}Organisation details{% if data.tabLocation == 'orgDetails' %}</strong>{% endif %}
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
{% endblock %}

{% block pageScripts %}
<script>
// 1. Left column links behavior
document.querySelectorAll('a.learner-jump-link').forEach(link => {
  link.addEventListener('click', function(e) {
    e.preventDefault();

    const href = this.getAttribute('href');
    if (!href) return;

    const cardId = href.substring(1); // get ID from href
    const tabId = this.dataset.tab;
    if (!tabId) return;

    // Trigger a click on the tab link
    const tabLink = document.querySelector(`.govuk-tabs__tab[href="#${tabId}"]`);
    if (tabLink) {
      tabLink.click();

      // Wait for the tab panel to become visible
      setTimeout(() => {
        // Decode cardId to handle URL-encoded spaces (%20)
        const decodedCardId = decodeURIComponent(cardId);

        // Use querySelector to find the element with spaces in ID
        const card = document.querySelector(`[id="${decodedCardId}"]`);
        if (card) {
          card.scrollIntoView({ behavior: 'smooth', block: 'start' });
          history.replaceState(null, '', '#' + decodedCardId); // Update URL hash
        }
      }, 100);
    }
  });
});


window.addEventListener('load', () => {
  // Decode hash to handle %20 and other encoded characters
  const hash = decodeURIComponent(window.location.hash.substring(1));
  if (!hash) return;

  const card = document.querySelector(`[id="${hash}"]`);
  if (!card) return;

  const tabPanel = card.closest('.govuk-tabs__panel');
  if (!tabPanel) return;

  const tabId = tabPanel.id;
  const tabLink = document.querySelector(`.govuk-tabs__tab[href="#${tabId}"]`);
  if (!tabLink) return;

  tabLink.click();

  setTimeout(() => {
    card.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }, 100);
});
</script>
{% endblock %}