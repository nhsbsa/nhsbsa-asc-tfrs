{% extends "../layouts/processing-main.html" %}

{% set claim = data.id | findClaim_V8(data.claims) %}

{% block pageTitle %}
{{ ["Claim: ", claim.claimID, " - process a claim"] | join }}
{% endblock %}

{% block beforeContent %}
<a href="start-process" class="govuk-back-link">Back</a>
{% endblock %}

{% block content %}
<div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
        <span class="govuk-caption-l">Process a claim</span>
        <h1 class="govuk-heading-l">Claim: {{ claim.claimID }}<br>{{ claim.status | processorstatusTag_V2 }}</h1>
    </div>
</div>

<div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
        <dl class="govuk-summary-list govuk-summary-list--no-border">
            <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
                Training
            </dt>
            <dd class="govuk-summary-list__value">
                {{claim.training.title}}
            </dd>
            </div>
            <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
                Provider
            </dt>
            <dd class="govuk-summary-list__value">
                {{claim.training.awardingOrganisation}}
            </dd>
            </div>
            <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
                Maximum reimbursable amount
            </dt>
            <dd class="govuk-summary-list__value">
                Â£{{claim.training.reimbursementAmount}}
            </dd>
            </div>
            <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">
                Learner
                </dt>
                <dd class="govuk-summary-list__value">
                    {{claim.learner.givenName}} {{claim.learner.familyName}}
                </dd>
            </div>
            <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">
                Employer
                </dt>
                <dd class="govuk-summary-list__value">
                Oaktree Care Home Ltd
                </dd>
            </div>
            <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">
                Training date
                </dt>
                <dd class="govuk-summary-list__value">
                    {{ claim.startDate | govukDate("truncate") }} to {{ claim.completionDate | govukDate("truncate") }}
                </dd>
            </div>
        </dl>
    </div>
</div>

<div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
        {% if claim.status == "submitted" %}
        <h2 class="govuk-heading-m">Check evidence</h2>
        <ul class="govuk-task-list">
            <li class="govuk-task-list__item govuk-task-list__item--with-link">
                <div class="govuk-task-list__name-and-hint">
                    <a class="govuk-link govuk-task-list__link" href="../evidence-check-start-handler?type=payment" aria-describedby="company-details-1-status">
                        Evidence of payment
                    </a>
                </div>
                <div class="govuk-task-list__status" id="company-details-1-status">
                    {{ claim.evidenceOfPaymentreview.pass | sectionCheck_V2 }}
                </div>
            </li>
            <li class="govuk-task-list__item govuk-task-list__item--with-link">
                <div class="govuk-task-list__name-and-hint">
                    <a class="govuk-link govuk-task-list__link" href="../evidence-check-start-handler?type=completion" aria-describedby="company-details-2-status">
                        Evidence of completion
                    </a>
                </div>
                <div class="govuk-task-list__status" id="company-details-2-status">
                    {{ claim.evidenceOfCompletionreview.pass | sectionCheck_V2 }}
                </div>
            </li>
        </ul>

        <div class="govuk-button-group">
            <form action="../claim-process-handler" method="post" novalidate>
              <button type="submit" class="govuk-button" data-module="govuk-button">
                Complete claim
              </button>
            </form>
            <form method="post" novalidate>
              <button type="submit" class="govuk-button govuk-button--secondary" data-module="govuk-button">
                Save and exit
              </button>
            </form>
          </div>

        {% endif %}
    </div>
</div>


<div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
        <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible" style="margin-bottom: 40px;">
        <div class="moj-page-header-actions">
            <div class="moj-page-header-actions__title" >
                <h2 class="govuk-heading-m">Claim notes</h2>
            </div>
            <div class="moj-page-header-actions__actions">
                <div class="moj-button-menu">
                    <div class="moj-button-menu__wrapper">
                        <a href="add-note?id={{claim.claimID}}" role="button" draggable="false" class="govuk-button moj-button-menu__item govuk-button--secondary moj-page-header-actions__action" data-module="govuk-button">
                            Add note
                          </a>
                    </div>
                </div>
            </div>
        </div>
        {% if claim.notes.length > 0 %}     
            {% for note in claim.notes| dateSort_V2 %}     
                {% include "../_components/note.html" %}
            {% endfor %}
        {% else %}  
            <p>There are currently no notes for this claim.</p>   
        {% endif %}     
    </div>
</div>

{% endblock %}