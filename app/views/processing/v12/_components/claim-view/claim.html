{% set paymentCompleted = claim.evidenceOfPaymentreview.pass != null %}
{% set paymentRejectte = claim.evidenceOfPaymentreview.note %}
{% set completionCompleted = claim.evidenceOfCompletionreview.pass != null%}
{% set completionNote = claim.evidenceOfCompletionreview.note %}

{% set needsActionLearners = submission.learners | filterLearners("queried") %}
{% set criteriaMetLearners = submission.learners | filterLearners("pass") %}
{% set rejectedLearners = submission.learners | filterLearners("fail") %}

{% include "./claim-header.html" %}

<div class="govuk-grid-row">
    <div class="govuk-grid-column-one-half">

        {% include "./claim-details.html" %}

    </div>

    <div class="govuk-grid-column-one-half">

        <div style="padding-top: 10px;">
            {% if ((claim.claimType != "40") or (claim.claimType == "40" and claim.isPaymentPlan)) and not (submission.trainingCode | isInternalOMMT) %}
                <h3 class="govuk-heading-m">
                    Payment evidence
                </h3>
                    {% include "./evidence-of-payment-card.html" %}
            {% endif %}
            {% if (not (submission.trainingCode | isInternalOMMT) and claim.claimType == "100") or (claim.claimType == "40" and claim.isPaymentPlan)%}
                <hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible">
            {% endif %}
            {% if (claim.claimType != "60") %}
                <h3 class="govuk-heading-m">
                    Completion evidence
                </h3>
                {% if claim.status != 'submitted' %}
                    <p class="govuk-body">
                        {% if needsActionLearners.length > 0 %}
                            <strong>{{needsActionLearners.length}}</strong> learners <a href="#needsAction">need action</a></br>
                        {%endif %}
                        {% if criteriaMetLearners.length > 0 %}
                            <strong>{{criteriaMetLearners.length}}</strong> learners <a href="#criteriaMet">criteria met</a></br>
                        {%endif %}
                        {% if rejectedLearners.length > 0 %}
                            <strong>{{rejectedLearners.length}}</strong> learners <a href="#rejected">rejected</a></br>
                        {%endif %}
                    </p>
                    {% if needsActionLearners.length > 0 %}
                        <h3 class="govuk-heading-s" id="needsAction">Needs action</h3>
                        {% for learner in needsActionLearners | sortLearners %}
                            {% include "./evidence-of-completion-card.html" %}
                        {% endfor %}
                    {% endif %}
                    {% if criteriaMetLearners.length > 0 %}
                        <h3 class="govuk-heading-s" id="criteriaMet">Criteria met</h3>
                        {% for learner in criteriaMetLearners | sortLearners %}
                            {% include "./evidence-of-completion-card.html" %}
                        {% endfor %}
                    {% endif %}
                    {% if rejectedLearners.length > 0 %}
                        <h3 class="govuk-heading-s" id="rejected">Rejected</h3>
                        {% for learner in rejectedLearners | sortLearners %}
                            {% include "./evidence-of-completion-card.html" %}
                        {% endfor %}
                    {% endif %}
                {% else %}
                    {% for learner in submission.learners | sortLearners %}
                        {% include "./evidence-of-completion-card.html" %}
                    {% endfor %}
                {% endif %}
            {% endif %}
        </div>
    </div>
</div>